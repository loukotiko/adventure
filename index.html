<!doctype html>
<html>
  <head>
    <script type="module">
      import { createApp } from 'https://unpkg.com/petite-vue?module';
      const pokeapi = async (url) => await fetch(url).then(data => data.json());
      
      const STORAGE_KEY = 'adventure-main'
      const mainStorage = {
        fetch: () => JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'),
        save: (data) => localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
      }

      function Intro() {
        return {$template: '#intro-template', start(){ this.$emit('start') }}
      };      
      function Day() {
        return {$template: '#day-template', nextDay(){ this.$emit('nextDay') }})
      };

      createApp({
        title: 'Aventure v0.1',
        onMount() {
          // Prepare things on mount
        },
        nextDay() {
          this.data.story.push("test");
        },
        newAdventure() {
          this.data.story === "";
        },
        get day() {
          return this.data.story.length;
        },
        data: {
          hero: {},
          story: []
        },
        save() {
          mainStorage.save(this.data);
        },
        Intro,
        Day
      }).mount();
    </script>
  </head>
  <body>
    <div v-scope @vue:mounted="onMount" v-effect="save()" v-cloak>
      <h1>{{title}}</h1>
      <button @click="newAdventure">Nouvelle aventure</button>
      <template v-if="day === 0" v-scope="Intro()" @start="nextDay()"/>
      <template v-else v-scope="Day({day:day, data:data.story[day]})" @nextDay="nextDay()"/>
    </div>
    
    <template id="intro-template">
      <h2>Début de l'aventure</h2>
      <p>L'aventure commence !</p>
      <button @click="start">Démarrer l'aventure !</button>
    </template>
    
    <template id="day-template">
      <h2>Jour {{day}}</h2>
      <h1>Data : {{data}}</h1>
      <button @click="nextDay">Jour suivant</button>
    </template>
  </body>
</html>
